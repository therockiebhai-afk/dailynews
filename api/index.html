<!-- index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>India Daily News</title>
  <link rel="stylesheet" href="/styles.css">
  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand" href="/">India Daily News</a>
      <form id="searchForm" class="d-flex ms-auto" onsubmit="doSearch(event)">
        <input id="q" class="form-control me-2" placeholder="Search (e.g. cricket, AI)" />
        <select id="category" class="form-select me-2">
          <option value="">All</option>
          <option value="top">Top</option>
          <option value="business">Business</option>
          <option value="entertainment">Entertainment</option>
          <option value="health">Health</option>
          <option value="science">Science</option>
          <option value="sports">Sports</option>
          <option value="technology">Technology</option>
        </select>
        <button class="btn btn-primary" type="submit">Search</button>
      </form>
    </div>
  </nav>

  <header class="py-4 bg-light">
    <div class="container">
      <h1 class="h3">Fresh headlines — updated automatically</h1>
      <p class="text-muted">News for India. Tap an article to read more on the source site.</p>
    </div>
  </header>

  <main class="container my-4">
    <div id="ads-top" class="mb-3 text-center">
      <!-- AdSense placeholder: paste your AdSense script here after approval -->
      <div style="background:#eee;border-radius:8px;padding:18px;display:inline-block;width:100%;max-width:728px;">
        Advertisement (paste AdSense code here after approval)
      </div>
    </div>

    <div id="articles" class="row g-3"></div>

    <div class="text-center my-4">
      <button id="loadMore" class="btn btn-outline-secondary" onclick="loadMore()">Load more</button>
    </div>

    <div id="ads-bottom" class="my-4 text-center">
      <!-- Another ad spot -->
      <div style="background:#f3f3f3;border-radius:8px;padding:14px;display:inline-block;width:100%;max-width:468px;">
        Advertisement (bottom)
      </div>
    </div>
  </main>

  <footer class="py-4 bg-dark text-white">
    <div class="container text-center small">
      © <span id="year"></span> India Daily News — Powered by Newsdata.io
    </div>
  </footer>

  <script>
    document.getElementById('year').innerText = new Date().getFullYear();

    let page = 1;
    const perRequest = 12;
    let q = "";
    let category = "";

    async function fetchArticles(reset=false) {
      if (reset) { page = 1; document.getElementById('articles').innerHTML = ''; }
      const qs = new URLSearchParams();
      qs.set('page', String(page));
      if (q) qs.set('q', q);
      if (category) qs.set('category', category);

      const res = await fetch('/api/fetch?' + qs.toString());
      if (!res.ok) {
        document.getElementById('articles').innerHTML = '<div class="text-danger">Failed to load articles.</div>';
        return;
      }
      const data = await res.json();
      const arr = (data.articles || []);
      renderArticles(arr);
      if (arr.length < perRequest) document.getElementById('loadMore').style.display = 'none';
      else document.getElementById('loadMore').style.display = 'inline-block';
      page += 1;
    }

    function renderArticles(list) {
      const container = document.getElementById('articles');
      list.forEach(a => {
        const col = document.createElement('div');
        col.className = 'col-md-4';
        const card = document.createElement('div');
        card.className = 'card h-100';
        let image = '';
        if (a.image_url) {
          image = `<img src="${a.image_url}" class="card-img-top" style="height:200px;object-fit:cover;">`;
        }
        card.innerHTML = `
          ${image}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${escapeHtml(a.title || '')}</h5>
            <p class="card-text text-muted" style="flex:0 0 auto">${escapeHtml(a.description || '')}</p>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <a class="btn btn-sm btn-primary" href="${a.link}" target="_blank" rel="noopener">Read</a>
              <small class="text-muted">${a.pubDate ? new Date(a.pubDate).toLocaleString():''}</small>
            </div>
          </div>`;
        col.appendChild(card);
        container.appendChild(col);
      });
    }

    function escapeHtml(s) {
      if (!s) return '';
      return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    function loadMore() { fetchArticles(false); }
    function doSearch(e) {
      e.preventDefault();
      q = document.getElementById('q').value.trim();
      category = document.getElementById('category').value;
      fetchArticles(true);
    }

    // initial load
    fetchArticles(true);
  </script>
</body>
</html>
